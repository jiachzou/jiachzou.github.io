{% include base_path %}

<style>
.language-selector {
  position: relative;
  display: inline-block !important;
  margin-left: 15px;
  visibility: visible !important;
  z-index: 10;
}

.language-selector-btn {
  background: none;
  border: 1px solid #eee;
  border-radius: 4px;
  padding: 0.25rem 0.5rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  font-size: 0.8rem;
  transition: all 0.2s ease;
  color: inherit;
}

.language-selector-btn:hover {
  background-color: #f8f9fa;
  border-color: #9eceeb;
}

.language-icon {
  margin-left: 0.25rem;
  fill: currentColor;
}

.language-dropdown {
  position: absolute;
  top: 100%;
  right: 0;
  background-color: #fff;
  border: 1px solid #eee;
  border-radius: 4px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  z-index: 100;
  min-width: 120px;
  padding: 0.25rem 0;
  margin-top: 0.25rem;
  opacity: 0;
  visibility: hidden;
  transform: translateY(-10px);
  transition: all 0.2s ease;
}

.language-dropdown.show {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}

.language-dropdown li {
  margin: 0;
  list-style: none;
}

.language-dropdown a {
  display: block;
  padding: 0.5rem 0.75rem;
  color: #494e52;
  text-decoration: none;
  font-size: 0.8rem;
  transition: background-color 0.2s ease;
}

.language-dropdown a:hover {
  background-color: #f8f9fa;
}

.language-dropdown a.active {
  background-color: #9eceeb;
  color: #fff;
}

/* Ensure visibility in masthead and responsive behavior */
.masthead__menu-item .language-selector {
  display: inline-block !important;
  visibility: visible !important;
}

/* Force language selector to always be visible in greedy nav */
.greedy-nav .visible-links .masthead__menu-item:last-child {
  display: table-cell !important;
  visibility: visible !important;
  position: relative !important;
  z-index: 10 !important;
}

/* Ensure language selector is never hidden by greedy nav JavaScript */
.greedy-nav__toggle ~ .visible-links .masthead__menu-item:last-child {
  display: table-cell !important;
  visibility: visible !important;
}

/* For medium screens and below */
@media (max-width: 925px) {
  .masthead__menu-item .language-selector {
    margin-left: 10px;
    margin-right: 5px;
  }
  
  .language-selector-btn {
    padding: 0.2rem 0.4rem;
    font-size: 0.75rem;
  }
}

/* For small screens */
@media (max-width: 768px) {
  .masthead__menu-item .language-selector {
    margin-left: 5px;
    margin-right: 5px;
  }
  
  .language-selector-btn {
    padding: 0.2rem 0.3rem;
    font-size: 0.7rem;
  }
  
  .language-dropdown {
    min-width: 100px;
  }
  
  .language-dropdown a {
    padding: 0.4rem 0.6rem;
    font-size: 0.7rem;
  }
}
</style>

<div class="language-selector">
  <button class="language-selector-btn" id="language-btn">
    <span id="current-lang">EN</span>
    <svg class="language-icon" width="12" height="12" viewBox="0 0 24 24">
      <path d="M7 10l5 5 5-5z"/>
    </svg>
  </button>
  <ul class="language-dropdown" id="language-dropdown">
    <li><a href="{{ base_path }}/" class="lang-option" data-lang="en">English</a></li>
    <li><a href="{{ base_path }}/zh-cn/" class="lang-option" data-lang="zh-CN">简体中文</a></li>
    <li><a href="{{ base_path }}/zh-tw/" class="lang-option" data-lang="zh-TW">繁體中文</a></li>
  </ul>
</div>



<script>
document.addEventListener('DOMContentLoaded', function() {
  const languageBtn = document.getElementById('language-btn');
  const languageDropdown = document.getElementById('language-dropdown');
  const currentLangSpan = document.getElementById('current-lang');
  const langOptions = document.querySelectorAll('.lang-option');
  
  // Determine current language based on URL
  function getCurrentLanguage() {
    const path = window.location.pathname;
    if (path.includes('/zh-cn/')) return 'zh-CN';
    if (path.includes('/zh-tw/')) return 'zh-TW';
    return 'en';
  }
  
  // Update current language display
  function updateLanguageDisplay(lang) {
    currentLangSpan.textContent = lang === 'en' ? 'EN' : 
                                lang === 'zh-CN' ? '简' : '繁';
    
    // Update active state
    langOptions.forEach(opt => opt.classList.remove('active'));
    const activeOption = document.querySelector(`.lang-option[data-lang="${lang}"]`);
    if (activeOption) activeOption.classList.add('active');
  }
  
  // Toggle dropdown
  languageBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    languageDropdown.classList.toggle('show');
  });
  
  // Close dropdown when clicking outside
  document.addEventListener('click', function() {
    languageDropdown.classList.remove('show');
  });
  
  // Initialize language display
  updateLanguageDisplay(getCurrentLanguage());
});
</script>