{% include base_path %}

<div class="language-selector">
  <button class="language-selector-btn" id="language-btn">
    <span id="current-lang">EN</span>
    <svg class="language-icon" width="12" height="12" viewBox="0 0 24 24">
      <path d="M7 10l5 5 5-5z"/>
    </svg>
  </button>
  <ul class="language-dropdown" id="language-dropdown">
    <li><a href="{{ base_path }}/" class="lang-option" data-lang="en">English</a></li>
    <li><a href="{{ base_path }}/zh-cn/" class="lang-option" data-lang="zh-CN">简体中文</a></li>
    <li><a href="{{ base_path }}/zh-tw/" class="lang-option" data-lang="zh-TW">繁體中文</a></li>
  </ul>
</div>

<style>
.language-selector {
  position: relative;
  display: inline-block;
  margin-left: 15px;
}

.language-selector-btn {
  display: flex;
  align-items: center;
  background: transparent;
  border: 1px solid rgba(255, 255, 255, 0.5);
  border-radius: 4px;
  padding: 5px 10px;
  color: #fff;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.2s ease;
}

.language-selector-btn:hover {
  background-color: rgba(255, 255, 255, 0.1);
  border-color: rgba(255, 255, 255, 0.8);
}

.language-icon {
  margin-left: 5px;
  fill: currentColor;
}

.language-dropdown {
  position: absolute;
  top: 100%;
  right: 0;
  background-color: #fff;
  border: 1px solid #ddd;
  border-radius: 4px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  list-style: none;
  padding: 0;
  margin: 5px 0 0 0;
  min-width: 120px;
  z-index: 1000;
  display: none;
}

.language-dropdown.show {
  display: block;
}

.language-dropdown li {
  margin: 0;
}

.lang-option {
  display: block;
  padding: 8px 12px;
  color: #333;
  text-decoration: none;
  font-size: 14px;
  transition: background-color 0.2s;
}

.lang-option:hover {
  background-color: #f5f5f5;
}

.lang-option.active {
  background-color: #eaeaea;
  font-weight: bold;
}

/* Dark theme support */
.masthead__menu-item .language-selector-btn {
  color: inherit;
  border-color: rgba(255, 255, 255, 0.7);
}

.masthead__menu-item .language-selector-btn:hover {
  background-color: rgba(255, 255, 255, 0.1);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const languageBtn = document.getElementById('language-btn');
  const languageDropdown = document.getElementById('language-dropdown');
  const currentLangSpan = document.getElementById('current-lang');
  const langOptions = document.querySelectorAll('.lang-option');
  
  // Determine current language based on URL
  function getCurrentLanguage() {
    const path = window.location.pathname;
    if (path.includes('/zh-cn/')) return 'zh-CN';
    if (path.includes('/zh-tw/')) return 'zh-TW';
    return 'en';
  }
  
  // Update current language display
  function updateLanguageDisplay(lang) {
    currentLangSpan.textContent = lang === 'en' ? 'EN' : 
                                lang === 'zh-CN' ? '简' : '繁';
    
    // Update active state
    langOptions.forEach(opt => opt.classList.remove('active'));
    const activeOption = document.querySelector(`.lang-option[data-lang="${lang}"]`);
    if (activeOption) activeOption.classList.add('active');
  }
  
  // Toggle dropdown
  languageBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    languageDropdown.classList.toggle('show');
  });
  
  // Close dropdown when clicking outside
  document.addEventListener('click', function() {
    languageDropdown.classList.remove('show');
  });
  
  // Initialize language display
  updateLanguageDisplay(getCurrentLanguage());
});
</script>